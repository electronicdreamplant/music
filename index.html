<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio POC | ox1digital</title>
    <style>
        :root { --accent: #00d1b2; --bg: #121212; --card: #1e1e1e; }
        body { background: var(--bg); color: white; font-family: system-ui, sans-serif; padding: 2rem; max-width: 800px; margin: 0 auto; }
        h1 { border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-bottom: 30px; }
        
        .track-list { display: flex; flex-direction: column; gap: 20px; }
        .track-card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid #333; transition: transform 0.2s; }
        .track-card:hover { border-color: var(--accent); }
        
        .waveform-box { width: 100%; height: 80px; margin: 15px 0; background: rgba(0,0,0,0.2); border-radius: 4px; }
        
        .controls { display: flex; align-items: center; justify-content: space-between; }
        .play-toggle { 
            background: var(--accent); border: none; color: black; padding: 10px 25px; 
            border-radius: 50px; font-weight: bold; cursor: pointer; min-width: 100px;
        }
        .play-toggle.is-playing { background: #ff3860; color: white; }
        .track-meta { font-size: 0.9rem; opacity: 0.7; }
    </style>
</head>
<body>

    <h1>Music POC: Self-Hosted Streaming</h1>
    <p>Testing multiple <code>wavesurfer.js</code> instances with auto-switch logic.</p>

    <div class="track-list">
        <div id="tracks-container"></div>
    </div>

    <script type="module">
        import WaveSurfer from 'https://unpkg.com/wavesurfer.js@7/dist/wavesurfer.esm.js'

        // 1. Data: Your 5 local audio files
        const myTracks = [
            { id: 1, title: "Sollid State", file: "Electronic Dream Plant - Solid State.mp3" },
            { id: 2, title: "Ethereal", file: "Electronic Dream Plant - Ethereal.mp3" },
            { id: 3, title: "The Nature of Miracles", file: "The nature of miracles.mp3" },
            { id: 4, title: "A Stitch in Time", file: "A stitch in time.mp3" },
        ];

        // 2. Global State to manage "Only one plays at a time"
        let activeWavesurfer = null;
        const allInstances = [];

        const container = document.getElementById('tracks-container');

        // 3. Generator Loop
        myTracks.forEach(track => {
            // Create the HTML structure
            const card = document.createElement('div');
            card.className = 'track-card';
            card.innerHTML = `
                <div class="controls">
                    <h3 style="margin:0">${track.title}</h3>
                    <span class="track-meta">Local File: ${track.file}</span>
                </div>
                <div id="wave-${track.id}" class="waveform-box"></div>
                <button class="play-toggle" id="btn-${track.id}">Play</button>
            `;
            container.appendChild(card);

            // Initialize Wavesurfer for this track
            const ws = WaveSurfer.create({
                container: `#wave-${track.id}`,
                waveColor: '#4f4f4f',
                progressColor: '#00d1b2',
                url: `./audio/${track.file}`, // Path to your audio folder
                barWidth: 3,
                barGap: 3,
                barRadius: 4,
                height: 80,
            });

            const btn = document.getElementById(`btn-${track.id}`);

            // 4. THE MAGIC LOGIC: Switching mid-stream
            ws.on('play', () => {
                // If another track is playing, stop it
                if (activeWavesurfer && activeWavesurfer !== ws) {
                    activeWavesurfer.pause();
                }
                activeWavesurfer = ws;
                btn.textContent = 'Pause';
                btn.classList.add('is-playing');
            });

            ws.on('pause', () => {
                btn.textContent = 'Play';
                btn.classList.remove('is-playing');
            });

            // Handle button click
            btn.onclick = () => ws.playPause();
            
            allInstances.push(ws);
        });
    </script>
</body>
</html>
